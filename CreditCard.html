<head>
  <script src="http://ajax.googleapis.com/ajax/libs/jquery/1.11.3/jquery.min.js"></script>
  <script type="text/javascript">
    var PAYMILL_PUBLIC_KEY = '71850066712bad20cdf3f646c5c74761';
  </script>
  <script type="text/javascript" src="https://bridge.paymill.com/"></script>
  <script type="text/javascript">
  $(document).ready(function() {
    $("#payment-form").submit(function(event) {
      // Deactivate submit button to avoid further clicks
      $('.submit-button').attr("disabled", "disabled");
      paymill.createToken({
        number: $('.card-number').val(),  // required, ohne Leerzeichen und Bindestriche
        exp_month: $('.card-expiry-month').val(),   // required
        exp_year: $('.card-expiry-year').val(),     // required, vierstellig z.B. "2016"
        cvc: $('.card-cvc').val(),                  // required
        amount_int: $('.card-amount-int').val(),    // required, integer, z.B. "15" 0,15 Euro
        currency: $('.card-currency').val(),    // required, ISO 4217 z.B. "EUR" od. "GBP"
        cardholder: $('.card-holdername').val() // optional
      }, PaymillResponseHandler);                   // Info dazu weiter unten
      console.log("submit");
      return false;
    });
  });
  function PaymillResponseHandler(error, result) {
    console.log("PaymillResponseHandler");
    if (error) {
      // Shows the error above the form
      $(".payment-errors").text(error.apierror);
      $(".submit-button").removeAttr("disabled");
      console.log("error: " + error.apierror);
    } else {
      var form = $("#payment-form");
      // Output token
      var token = result.token;
      // Insert token into form in order to submit to server
      console.log(token);
      var user_id = "1"; //user_id des eingeloggten Nutzers hier einfuegen.
      $.ajax({
         type: "GET",
         url: "http://localhost:8080/SharityOnline/payment/" + user_id + "/" + token,
         contentType: "application/json; charset=utf-8",
         dataType: "jsonp",
         data: null,
         success: function (data, status, jqXHR) {
              console.log("success");
         },
         error: function (jqXHR, status) {            
              console.log(status);
         }
      });
      form.append("");
    }
  }
  </script>
</head>
<form id="payment-form" action="#" method="POST">

  <input class="card-amount-int" type="hidden" value="1500" />
  <input class="card-currency" type="hidden" value="EUR" />

  <div class="form-row">
    <label>Card number</label>
    <input class="card-number" type="text" value="4111111111111111" size="20" />
  </div>

  <div class="form-row">
    <label>CVC</label>
    <input class="card-cvc" type="text" value="111" size="4" />
  </div>

  <div class="form-row">
    <label>Name</label>
    <input class="card-holdername" type="text" value="Name egal" size="4" />
  </div>

  <div class="form-row">
    <label>Expiry date (MM/YYYY)</label>
    <input class="card-expiry-month" type="text" value="11" size="2" />
    <span></span>
    <input class="card-expiry-year" type="text" value="2020" size="4" />
  </div>


  <button class="submit-button" type="submit">Submit</button>

</form>

